@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
@using Umbraco.Cms.Core.Models

@{
    var siteProps = Umbraco.ContentAtRoot().FirstOrDefault().Children().Where(x => x.ContentType.Alias == "siteProperties");
    var siteProperties = siteProps.First();
    var dsVersion = siteProperties.Value<string>("designSystemSlug");
    var showFooter = false; @* Placeholder var to detrmine if to show footer based on if we can access its contents *@

  @* Check siteProps to see if it returns anything... *@
  if(siteProps.Any()){
    var footer = siteProps.First().Children.Where(x => x.ContentType.Alias == "footer"); @* As siteProps exists, get any docType with the alias footer. If not found, will return a null *@

    @* Check footer to see if it returns anything *@
    if(footer.Any()){
      showFooter = true; @* If so, we can show our footer and it's props *@
    }
  }
}

@if (showFooter)
{
  var footer = siteProps.First().Children.Where(x => x.ContentType.Alias == "footer").First(); @* Get all nav settings from footer docType *@

  @* Column 1 *@
  var col1Title = footer.Value<String>("column1Title");
  var content = footer.Value<String>("content");
  var ctaLink = footer.Value<Link>("cTAButton");
  @* Column 2 *@
  var col2Title = footer.Value<String>("column2Title");
  var col2Links = footer.Value<IEnumerable<Link>>("column2Links");
  @* Column 3 *@
  var col3Title = footer.Value<String>("column3Title");
  var col3Links = footer.Value<IEnumerable<Link>>("column3Links");
  @* Socials *@
  var facebookLink = footer.Value<Link>("facebookLink");
  var twitterLink = footer.Value<Link>("xTwitterLink");
  var instagramLink = footer.Value<Link>("instagramLink");
  var linkedinLink = footer.Value<Link>("linkedIn");
  @* Bottom menu *@
  var copyrightText = footer.Value<String>("copyrightText");
  var bottomLinks = footer.Value<IEnumerable<Link>>("bottomLinks");

<footer>
  <div class="@dsVersion-footer @dsVersion-footer--v2">
    <div class="@dsVersion-container @dsVersion-grid">
      @* Column 1 (this section requires a title - it has validation) *@
      @if (!String.IsNullOrEmpty(col1Title)) {
        <div class="@dsVersion-col-1 @dsVersion-col-lg-1-3 @dsVersion-footer__updates-col">
            <h3 class="@dsVersion-footer__heading">@col1Title</h3>

          @if (!String.IsNullOrEmpty(content)) {
            <p>@content</p>
          }

          @if (ctaLink != null) {
            <a href="@ctaLink.Url" class="@dsVersion-btn @dsVersion-footer__btn @dsVersion-footer__btn--block" target="@ctaLink.Target">
              @ctaLink.Name
            </a>
          }
        </div>
      }

      @* Column 2 (this section requires a title - it has validation) *@
      @if (!String.IsNullOrEmpty(col2Title)) {
        <div class="@dsVersion-col-1 @dsVersion-col-lg-1-3">
          <h3
            class="@dsVersion-footer__heading @dsVersion-collapse-heading"
            aria-controls="footer-menu-col2"
            aria-expanded="true"
          >
            @col2Title
            <svg class="@dsVersion-collapse-heading__indicator">
              <use xlink:href="#@dsVersion-general-chevron-right" href="#@dsVersion-general-chevron-right"></use>
            </svg>
          </h3>

          @if (col2Links.Any()){
            <ul class="@dsVersion-footer__menu @dsVersion-collapse-panel" id="footer-menu-col2">
              @foreach (var col2Link in col2Links) {
                <li>
                  <a href="@col2Link.Url" class="@dsVersion-footer__link">
                    @col2Link.Name
                  </a>
                </li>
              }
            </ul>
          }
        </div>
      }

      @* Column 3  *@
      <div class="@dsVersion-col-1 @dsVersion-col-lg-1-3">
         @* (this section requires a title - it has validation) *@
         @if (!String.IsNullOrEmpty(col3Title)) {
          <h3
            class="@dsVersion-footer__heading @dsVersion-collapse-heading"
            aria-controls="footer-menu-col3"
            aria-expanded="true"
          >
            @col3Title
            <svg class="@dsVersion-collapse-heading__indicator">
              <use xlink:href="#@dsVersion-general-chevron-right" href="#@dsVersion-general-chevron-right"></use>
            </svg>
          </h3>

          if(col3Links.Any()){
            <ul class="@dsVersion-footer__menu @dsVersion-collapse-panel" id="footer-menu-col3">
              @foreach (var col3Link in col3Links) {
                <li>
                  <a href="@col3Link.Url" class="@dsVersion-footer__link">
                    @col3Link.Name
                  </a>
                </li>
              }
            </ul>
          }
        }

        @* Social (this section requires at least one social link to render) *@
        @if (facebookLink != null || twitterLink != null || instagramLink != null){
          <h3 class="@dsVersion-footer__heading">Social media</h3>
          <ul class="@dsVersion-footer__social-media">
            @if (facebookLink != null) {
              <li>
                <a href="@facebookLink.Url" title="@facebookLink.Name" target="@facebookLink.Target">
                  <svg>
                    <use xlink:href="#@dsVersion-social-facebook" href="#@dsVersion-social-facebook"></use>
                  </svg>
                </a>
              </li>
            }
            @if (twitterLink != null) {
              <li>
                <a href="@twitterLink.Url" title="@twitterLink.Name" target="@twitterLink.Target">
                  <svg>
                    <use xlink:href="#@dsVersion-social-twitter" href="#@dsVersion-social-twitter"></use>
                  </svg>
                </a>
              </li>
            }
            @if (instagramLink != null) {
              <li>
                <a href="@instagramLink.Url" title="@instagramLink.Name" target="@instagramLink.Target">
                  <svg>
                    <use xlink:href="#@dsVersion-social-instagram" href="#@dsVersion-social-instagram"></use>
                  </svg>
                </a>
              </li>
            }
            @if (linkedinLink != null) {
              <li>
                <a href="@linkedinLink.Url" title="@linkedinLink.Name" target="@linkedinLink.Target">
                  <svg>
                    <use xlink:href="#@dsVersion-social-instagram" href="#@dsVersion-social-instagram"></use>
                  </svg>
                </a>
              </li>
            }
          </ul>
        }
      </div>
    </div>
    <div class="@dsVersion-container">
      <div class="@dsVersion-footer__bottom @dsVersion-grid">
        @* Copyright *@
        <div class="@dsVersion-col-1 @dsVersion-col-md-1-2">
          <p class="@dsVersion-footer__copyright">&copy; @copyrightText @DateTime.Now.Year</p>
        </div>
        @* Bottom links *@
        @if (bottomLinks.Any()){
          <div class="@dsVersion-col-1 @dsVersion-col-md-1-2">
            <ul class="@dsVersion-footer__bottom-menu">
              @foreach (var bottomLink in bottomLinks) {
                <li>
                  <a href="@bottomLink.Url" class="@dsVersion-footer__link">
                    @bottomLink.Name
                  </a>
                </li>
              }
            </ul>
          </div>
        }
      </div>
    </div>
  </div>
</footer>
}